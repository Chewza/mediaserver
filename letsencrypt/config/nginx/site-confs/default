
# listening on port 80 disabled by default, remove the "#" signs to enable
# redirect all traffic to https
# server {
# 	listen 80;
# 	server_name _;
# 	return 301 https://$host$request_uri;
# }

# https://portainer.readthedocs.io/en/stable/faq.html#how-can-i-configure-my-reverse-proxy-to-serve-portainer
upstream portainer {
	server	portainer:9000;
}

# main server block
server {
	listen 443 ssl http2 default_server;
	server_name _;

	include /config/nginx/ssl.conf;

	# default root redirect
	# location / {
	# 	return 404;
	# }

	root /config/www;
	index index.html index.htm index.php;

	location / {
		try_files $uri $uri/ /index.html /index.php?$args =404;
	}

	# location ~ \.php$ {
	# 	fastcgi_split_path_info ^(.+\.php)(/.+)$;
	# 	# With php7-cgi alone:
	# 	fastcgi_pass 127.0.0.1:9000;
	# 	# With php7-fpm:
	# 	#fastcgi_pass unix:/var/run/php7-fpm.sock;
	# 	fastcgi_index index.php;
	# 	include /etc/nginx/fastcgi_params;
	# }

	# https://portainer.readthedocs.io/en/stable/faq.html#how-can-i-configure-my-reverse-proxy-to-serve-portainer
	location /portainer/ {
		proxy_http_version 1.1;
		proxy_set_header Connection "";
		proxy_pass http://portainer/;
	}

	location /portainer/ws/ {
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
		proxy_pass http://portainer/ws/;
	}

	location /hydra {
		include /config/nginx/proxy.conf;
		proxy_pass http://hydra:5075;
	}

	location /sonarr {
		include /config/nginx/proxy.conf;
		include /config/nginx/auth.conf;
		proxy_pass http://sonarr:8989;
	}

	location /radarr {
		include /config/nginx/proxy.conf;
		include /config/nginx/auth.conf;
		proxy_pass http://radarr:7878;
	}

	location /plexpy/ {
		include /config/nginx/proxy.conf;
		include /config/nginx/auth.conf;
		proxy_pass http://plexpy:8181;
	}

	location /nzbget {
		include /config/nginx/proxy.conf;
		include /config/nginx/auth.conf;
		proxy_pass http://nzbget:6789;
	}

	location /transmission {
		include /config/nginx/proxy.conf;
		include /config/nginx/auth.conf;
		proxy_pass http://transmission:9091;
	}
}
